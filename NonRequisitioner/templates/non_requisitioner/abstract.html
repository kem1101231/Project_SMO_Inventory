{% extends 'non_requisitioner/base.html' %}

{% load staticfiles %}
{% load humanize %}
{% block content %}
    <style type="text/css">
        
        .test25{
            width: 100%;
            height: 100%;
        
        }
         

        .test25 img{
             
             
             max-height: 150px;
             
         }
         .dataFont1{
            
            font-size: 15px; 
            font-weight: bold; 
            padding:7px; 
            margin-bottom:2px;
        
         }

         .dataFont2{
            
            font-weight: 450;  
            font-size: 15px;
            padding:7px; 
            margin-bottom:2px;
         }

        .dataFont3{
            
            font-size: 15px; 
            font-weight: bold; 
            padding:7px;
        
         }

         .dataFont4{
            
            font-weight: 450;  
            font-size: 15px;
            padding:7px;
         }
        

    </style>
       <div id="page-wrapper">


            <!--  ========================================================   -->

            
            <form id="theReqData" action="" method="POST">{% csrf_token %}
            <div class="panel-body" style="
                 margin-bottom: 0px;
                 padding-left: 15px;
                 font-size: 25px;
                 padding-top: 10px;
                 padding-bottom: 0px;
                 margin-top:50px; 

                ">
                <div>
                    {% if pageData1.0.0 == None %}
                       <span name="reqNum" value="{{pageData1.0.0}}">Request Details</span>
                    {% else %}
                       <span style="font-size: 20px;">Abstract Of Canvanss No.: </span><span id="reqNum" name="reqNum" value="{{pageData1.0.0}}"> {{pageData1.0.0}}</span><span> - Selection of Bids</span>
                    {% endif %}
                </div>
                 
               </div>
               </form>
            <div id="page-inner" style="margin-top:0px; background-color: #ddd!important;">
             
                <hr>
                 
                <div class="col-lg-5" style="">
                         <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Reference Information</h3>
                            </div>
                            <div class="panel-body" style="height:232px; padding-left:20px;">
                            
                             <div class="form-group">
                                <div style="padding-left: 2px; width:100%; ">
                                    <div class="col-lg-5 dataFont2" >
                                        P.R. No.:  
                                    </div>
                                    <div class="col-lg-6 dataFont1" >
                                        {{pageData4.0.1}}
                                    </div>
                                </div> 
                            </div>
                            
                            <div class="form-group">
                                <div style="padding-left: 2px;  width:100%;">
                                    <div class="col-lg-5 dataFont2">
                                        Date Created:  
                                    </div>
                                    <div class="col-lg-6 dataFont1" >
                                       {{pageData4.0.5}}
                                    </div>
                                </div> 
                            </div> 
                            <div class="form-group" >
                                <div style="padding-left: 2px;  width:100%;">
                                    <div class="col-lg-5 dataFont2">
                                        Date Approved:  
                                    </div>
                                    <div class="col-lg-6 dataFont1">
                                        {{pageData4.0.11}}
                                    </div>
                                </div> 
                            </div>

                            <div class="form-group" >
                                <div style="padding-left: 2px;  width:100%;">
                                    <div class="col-lg-5 dataFont2">
                                        
                                    </div>
                                    <div class="col-lg-6 dataFont1">
                                        
                                    </div>
                                </div> 
                            </div>
                           
                              <div class="form-group">
                                <div style="padding-left: 2px; width:100%;">
                                    <div class="dataFont4" >
                                        Purpose:  
                                    </div>
                                    <div class="dataFont3" style="text-indent:30px;">
                                       {{pageData4.0.2}}
                                    </div>
                                </div> 
                            </div>
                             
                                
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-7"  style="padding-left:0px; ">
                           
                           <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Suppliers</h3>
                            </div>
                            <div class="panel-body" style="height:232px;">
                                
                            <div style="max-height:232px;">
                                <div class="table-responsive" >
                                <table class="table table-striped table-bordered table-hover" id="theTable">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th class="text-center">Rating</th>
                                            <th class="text-center"  style="width:50px;">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for x in pageData2 %}
                                        <tr>
                                            <td>{{x.1}}</td>
                                            <td class="text-center">
                                            <i class="icon-star"></i>
                                            <i class="icon-star"></i>
                                            <i class="icon-star"></i>
                                            <i class="icon-star"></i>
                                            <i class="icon-star"></i>
                                            </td>
                                            <td><button class="btn btn-xs btn-primary" id="{{x.0}}_btn" name="suppBTN" value="{{x.0}}">Details <i class="icon-arrow-right"></i></button></td>
                                        </tr>

                                        {% endfor %}

                                    </tbody>
                                </table>
                            </div>
                            </div>
                                
                                
                            </div>
                        </div>
                    </div>
                
                <div class="col-lg-12" style="display: inline;">
                    
                       

                        <!--  -->
                        
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Suppliers' Items' Price Bids </h3>
                            </div>
                            <div class="panel-body">

                                 <div class="panel-body" style="
                 margin-bottom: 0px;
                 padding-left: 0px;
                 font-size: 17px;
                 padding-top: 10px;
                 padding-bottom: 0px;

                ">
                <div class="text-center">
                    Select or click on your prefered bid from the following bids on the table below
                </div>
                 
               </div>
               <br>


                                  <div id="wrap" style="position:relative;">
                            <div id="wrap" style="position:relative;">
                            <div id="left" class ="panel"
                                style="
                                    height: 150px;
                                ">
                                 <div class="panel-body" style="
                                 padding-top:0px;
                                 padding-left: 0px;
                                 padding-right: 0px;
                                 ">

                            <div class="table-responsive">
                                <div id="dataTables-example_wrapper" class="dataTables_wrapper form-inline" role="grid">
                                    
                        <div class="col-md-12" style="
                                    padding-left: 0px;
                                    padding-right: 0px;
                                    ">
                                <div class="panel">
                            <div class="table-responsive">
                                <table id="itemTable" class="table table-kitchen">
                                    <thead>
                                       
                                        <tr>
                                            <th >Requested Item Description</th>
                                            {% for x in pageData2 %}
                                                <th class="text-center">{{x.1}}</th>
                                            {% endfor %}
                                            
                                        </tr>
                                    </thead>
                                    <tbody>

                                    {% for x in pageData3 %}
                                        <tr id="{{x.0.0}}">
                                           {% for y in x %} 
                                           {% if y == x.0 %}
                                           <td style="font-weight:bold;">{{y.1}}</td>
                                           {% else %}

                                                {% if y.1 == 0.0  %}
                                                    
                                                     <td class="text-center col-lg-2" >
                                                    <button id="{{y.0}}-{{x.0.0}}" value="{{y.0}}" role="button" type = "button" class="btn btn-default" disabled style="width:100%; border-color:red">
                                                    <div style="font-weight:bold;">
                                                        No bidded item
                                                    </div>
                                                    <div style="font-weight:bold;">
                                                        and price indicated
                                                    </div>
                                                    </button>
                                                   </td>
                                                
                                                {% else %}
                                                    
                                                    <td class="text-center col-lg-2" >
                                                    <button id="{{y.0}}-{{x.0.0}}" value="{{y.0}}" role="button" type = "button" class="btn btn-default" style="

                                                    {% if y.3 == True %}
                                                        
                                                        border-color: #449d44;
                                                    {% endif %}
                                                    
                                                    width:100%;


                                                    ">
                                                    <div style="font-weight:bold;">
                                                        {% if y.2 == '' %}
                                                        
                                                        Non-Defined Product

                                                        {% else %}

                                                            {{y.2}}

                                                        {% endif %}

                                                    </div>
                                                    <div>
                                                       ₱ {{y.1|intcomma}} each
                                                    </div>
                                                       
                                                    </button>
                                                   </td>
                                                
                                                {% endif %}

                                           
                                           {% endif %}
                                          
                                           {% endfor %}
                                        </tr>
                                      

                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                            

                    </div>


                    </div>
                                </div>

                            </div>
                           
                        </div>

                        </div>

                    

                    </div> 
                                
                            </div>
                        </div>
                    
                    <!-- -->

                </div>

                <div class="col-lg-12" style="display: inline;">
                    
                       

                        <!--  -->
                        
                        <div class="panel panel-default" style=" padding-bottom:15px;">
                            <div class="panel-body">
                                <div class="form-group" style="margin-top:20px;">
                                    <label for="autosize" class="control-label col-lg-4" style=" font-size: 18px;">Recomendation:</label>

                                    <div class="col-lg-6" >
                                        <textarea id="autosize" placeholder="Enter a short paragraph about the details on why you've chosen the specific bid/s" class="form-control" style="overflow: hidden; word-wrap: break-word; resize: horizontal; height: 100px;"></textarea>
                                    </div>

                                </div> 

                                <hr>

                            </div>
                        </div>
                    
                    <!-- -->

                </div>
                <div class="col-lg-12" style="display: inline;">
                    
                       

                        <!--  -->
                        
                        <div class="panel panel-default">
                            <div class="panel-body">
                               <form id="submitFrame" action="" method="POST">{% csrf_token %}
                                    <div class="form-group">
                                  <div class="header-right" style="padding:0px;">
                                                                                
                                        <button id="save" class="btn btn-success" type= "submit" role ="submit" aria-disabled="true"><i class="icon-ok"></i> Save and Update Abstract</button> 
                                                                            </div> 

                                </div> 
                                
                               </form>
                               
                            </div>
                        </div>
                    
                    <!-- -->

                </div>
                <!-- /. ROW  -->

                <div class="panel-body"  style="padding:0px;">
                    

               </div>


                </div>    


                </div> 

            </div>
            <!-- /. PAGE INNER  -->
            <!-- ===================================================   Modal ==================================================================================  -->
           
                       <div class="modal fade" id="transCompDisplay" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog ">
                                <div class="modal-content ">
                                   
                                    
                                    <div class="modal-body ">

                                        <div class="media" role="submit" name="notif1" id="notif1" value="GGWP">
                                    
                                            <span class="pull-left" >
                                                <div class="btn btn-success btn-lg btn-circle" role="button" aria-disabled="true" disabled = "disabled">
                                                    <i class="icon-ok"></i></div>
                                    </span>  
                                    <div class="media-body">
                                        <h5 class="media-heading" style="margin-top:10px;">
                                            <strong>Abstract of Bids Selection Transaction Complete</strong>
                                        </h5>
                                        <hr>
                                        
                                        <p style="margin-bottom:10px;">• You have successfully selected prefered bids and updated the Abstract's status</p>
                                        <p style="margin-bottom:10px;">• Information regarding on this transaction will be sent to the personnel or office responsible on tasks after this selection.</p>   
                                        <p style="margin-bottom:10px;">• Please print the newly downloaded document, sign it and deliver to the procurement office as a part of the S.O.P.</p>
                                    </div>
                                    

                                </div>
                                        
                                    </div>
                                        
                                    <div class="modal-footer">
                                            <button id="sentNotifConf" data-dismiss="modal" type="submit" class="btn btn-info">OK</button>
                                    </div>
                                </div>
                            </div>
                        </div>

<!-- ===================================================   Modal ==================================================================================  -->

        <!-- ===================================================   Modal ==================================================================================  -->
           
                       <div class="modal fade" id="genACModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog ">
                                <div class="modal-content ">
                                   
                                    
                                    <div class="modal-body ">

                                        <div class="media" role="submit" name="notif1" id="notif1" value="GGWP">
                                    
                                            <span class="pull-left" >
                                                <div class="btn btn-warning btn-lg btn-circle" role="button" aria-disabled="true" disabled = "disabled">
                                                    <i class="icon-ok"></i></div>
                                    </span>  
                                    <div class="media-body">
                                        <h5 class="media-heading" style="margin-top:10px;">
                                            <strong>Generating Abstract of Bids Document</strong>
                                        </h5>
                                        <hr>
                                        
                                        <p style="margin-bottom:10px;">• Currently generating the document for this transaction. The document will be automatically downloaded to your computer</p>
                                        <p style="margin-bottom:10px;">• This may take some time. Please do not close this until the download starts.</p> 

                                    </div>
                                    

                                </div>
                                        
                                    </div>
                                        
                                    <div class="modal-footer">
                                            <button id="genNotifConf" data-dismiss="modal" type="submit" class="btn btn-danger">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>

<!-- ===================================================   Modal ==================================================================================  -->


        </div>
        <!-- /. PAGE WRAPPER  -->
    </div>
    <!-- /. WRAPPER  -->
    <div id="footer-sec">
        &copy; Mindanao State University - Supply and Equipement Inventory
    </div>
    <!-- /. FOOTER  -->
    <!-- SCRIPTS -AT THE BOTOM TO REDUCE THE LOAD TIME-->
    <!-- JQUERY SCRIPTS -->
<script src="{% static 'requisitioner/assets/js/jquery-1.10.2.js' %}"></script>
    <!-- BOOTSTRAP SCRIPTS -->
    <script src="{% static 'requisitioner/assets/js/bootstrap.js' %}"></script>
    <!-- METISMENU SCRIPTS -->
    <script src="{% static 'requisitioner/assets/js/jquery.metisMenu.js' %}"></script>
    <!-- CUSTOM SCRIPTS -->
    <script src="{% static 'requisitioner/assets/js/custom.js' %}"></script>
    <script type="text/javascript">

    var chosenBid = {}
        
   $('#itemTable').on('click','button', function (e) {
        
        var id = this.id;
        var value = document.getElementById(id).value
        var trID = $(this).closest('tr').attr('id');


        $('#'+trID+' button').each(function(){
            $(this).attr('class', 'btn btn-default');
    
        })

        chosenBid[trID] = value;
        $("#"+id).attr('class', 'btn btn-success');
        
    });

   $('#save').click(function(e) {
       
       var recom = $('#autosize').val();

       if (recom === ''||chosenBid === {}) {
            alert("Provide All Data First");
            return false;
       } else {
            return true;
       }


   })

   $('#genNotifConf').click(function (e) {
      $('#transCompDisplay').modal('toggle');
   })

   $('#sentNotifConf').click(function (e) {
      window.location.href = "/requisitioner/pr/"; 
   })


   $(document).on('submit', '#submitFrame', function(e){

       e.preventDefault();


            $.ajax({
                type: 'POST',
                url:'/requisitioner/updateAbstract/',
                data:{
                    
                    'chosenBid': JSON.stringify(chosenBid),
                    'canvnum': $('#reqNum').attr('value'),
                    'recomend': $('#autosize').val(),
                     csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
                   
                },

                    success: function(response) {

                        window.location.href = "/requisitioner/generateACDocument/";
                        $('#genACModal').modal('toggle');
                        
                    }

            });
   })
    </script>
        <script type="text/javascript">
       
        $(document).ready(function () {
            
            $('.theUL nav-second-level').attr('class', 'nav-second-level theUL');  
            $('.theAsTop').attr('class', 'theAsTop');   
            $('.theAs').attr('class', 'theAs');   
            $('#home').attr('class', 'active-menu-nonrequi theAs');
       
        })
       
        
    </script>

{% endblock %}
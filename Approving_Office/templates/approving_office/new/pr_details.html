{% extends baseSource %}
{% load staticfiles %}
{% load humanize %}
{% block content %}
        
        <!-- /. NAV SIDE  -->
         <div id="page-wrapper">
      
            <form id="theReqData" action="" method="POST">{% csrf_token %}
            <div class="panel-body" style="
                 margin-bottom: 0px;
                 padding-left: 15px;
                 font-size: 25px;
                 padding-top: 10px;
                 padding-bottom: 0px;
                 margin-top:50px; 

                ">
                <div>
                 <span name="reqNum" id="reqNum" value="{{pageData1.0.0}}">Purchase Request Details</span>
                 
                </div>
                 
               </div>
               </form>
            <div id="page-inner" style="margin-top:0px; background-color: #555!important;">
             
                <hr>
                 
                <div class="col-lg-7" style="">
                         <div class="panel panel-info">
                            <div class="panel-heading">
                                <h3 class="panel-title">Basic Information</h3>
                            </div><!-- -->
                            <div class="panel-body" style="height: 250px;  padding-left:20px;">
                             <div class="form-group">
                                <div style="padding-left: 2px; width:100%; ">
                                    <div class=" dataFont2 col-lg-5" >
                                        Date of Request:  
                                    </div>
                                    <div class="dataFont1 col-lg-7" >
                                        {{pageData1.0.5}} 
                                    </div>
                                </div> 
                            </div>
                            <div class="form-group">
                                <div style="padding-left: 2px; width:100%; ">
                                    <div class=" dataFont2 col-lg-5" >
                                        Date Approved:  
                                    </div>
                                    <div class="dataFont1 col-lg-7" >
                                        Month dd, YYYY
                                    </div>
                                </div> 
                            </div>
                            <div class="form-group">
                                <div style="padding-left: 2px; width:100%; ">
                                    <div class=" dataFont2 col-lg-5" >
                                          
                                    </div>
                                    <div class="dataFont1 col-lg-7" >
                                        
                                    </div>
                                </div> 
                            </div>
                           

                            
                             <div class="form-group">
                                <div style="padding-left: 2px; width:100%; ">
                                    <div class=" dataFont2 col-lg-5" >
                                        Requesting Personnel:  
                                    </div>
                                    <div class="dataFont1 col-lg-7" >{{pageData1.2.6}} {{pageData1.2.1}} {{pageData1.2.7}} {{pageData1.2.2}} {{pageData1.2.8}}
                                    </div>
                                </div> 
                            </div>
                           
                            <div class="form-group">
                                <div style="padding-left: 2px; width:100%; ">
                                    <div class=" dataFont2 col-lg-5" >
                                        Office:  
                                    </div>
                                    <div class="dataFont1 col-lg-7" >{{pageData1.3.1}}    
                                    </div>
                                </div> 

                            </div>
                            
                            <div class="form-group">
                                <div style="padding-left: 2px; width:100%; ">
                                    <div class=" dataFont2 col-lg-5" >
                                        Purpose:
                                    </div>
                                    <div class="dataFont1 col-lg-7" >
                                        {{pageData1.0.2}} 
                                    </div>
                                </div> 
                            </div>
                                
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5" style=" padding-left:0px;">
                         <div class="panel panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">Update Information</h3>
                            </div>
                            <div class="panel-body" style="height: 250px;  padding-left:20px;">
                            
                             <div class="form-group" style="padding-bottom: 47px; padding-top: 23px;">
                                <div style="padding-left: 2px; width:100%; ">
                                    <div class=" dataFont2 col-lg-5" style="padding-top: 13px;">
                                       Receive Status:
                                    </div>
                                    <div class="dataFont1 col-lg-7" >

                                    {% if pageData1.4.0 == 'vcaf' %}
                                         {% if pageData1.1.1 == None %}
                                            <button class="btn btn-sm btn-warning" style="width: 90px; border-radius: 13px;" id="recBTN"  ><i class="icon-ok" ></i> Received</button>
                                        {% else %}
                                            <button class="btn btn-sm " style="width: 90px; border-color: #449d44; color: #449d44; background: white;" disabled=""><i class="icon-ok"></i> Received</button>
                                        {% endif %}
                                    {% else %}
                                         {% if pageData1.1.5 == None %}
                                            <button class="btn btn-sm btn-warning" style="width: 90px; border-radius: 13px;" id="recBTN" ><i class="icon-ok"></i> Received</button>
                                        {% else %}
                                            <button class="btn btn-sm " style="width: 90px; border-color: #449d44; color: #449d44; background: white;" disabled=""><i class="icon-ok"></i> Received</button>
                                        {% endif %}
                                    {% endif %}

                                   
                                       
                                    
                                    </div>
                                </div> 
                            </div>
                                
                                <div class="form-group" style="padding-bottom: 47px;">
                                <div style="padding-left: 2px; width:100%; ">
                                    <div class=" dataFont2 col-lg-5" style="padding-top: 13px;">
                                        Approval Decission:
                                    </div>
                                    <div class="dataFont1 col-lg-7" >

                                    {% if pageData1.4.0 == 'vcaf' %}
                                        
                                        {% if pageData1.1.1 == None %}
                                                 
                                                 <button class="btn btn-sm btn-default" style="width: 90px; border-radius: 13px;" disabled=""><i class="icon-ok"></i> Approved</button> 
                                                 <button class="btn btn-sm btn-default" style="width: 90px; border-radius: 13px;" disabled=""><i class="icon-remove"></i> Denied</button>
                                            
                                            {% else %}
                                                 
                                                 {% if pageData1.0.7 == None %}
                                                     
                                                     <button class="btn btn-sm btn-success" style="width: 90px; border-radius: 13px;" id="apprvBTN"><i class="icon-ok"></i> Approved</button> 
                                                     <button class="btn btn-sm btn-danger" style="width: 90px; border-radius: 13px;" id="declBTN" data-toggle="modal"  data-target="#newReg"><i class="icon-remove"></i> Denied</button>
                                                 
                                                 {% else %}
                                                     {% if pageData1.1.3 != None %}
                                                            {% if pageData1.0.7 == True %}
                                                                <button class="btn btn-sm" style="border-color: #398439; color: #398439; background: white; width: 90px;" disabled=""><i class="icon-ok"></i> Approved</button>
                                                                
                                                            {% else %}
                                                                 
                                                               <button class="btn btn-sm " style="border-color: #d43f3a; color: #d43f3a; background: white; width: 90px;" disabled=""><i class="icon-remove"></i> Denied</button>

                                                            {% endif %}
                                                    
                                                    {% else %}
                                                            {% if pageData1.0.7 == True %}
                                                                <button class="btn btn-sm btn-success" style="width: 90px; border-radius: 13px;" id="apprvBTN"><i class="icon-ok"></i> Approved</button> 
                                                                <button class="btn btn-sm btn-danger" style="border-color: #d43f3a; color: #d43f3a; background: white; border-radius:13px; width: 90px;" id="declBTN" data-toggle="modal"  data-target="#newReg"><i class="icon-remove"></i> Denied</button>
                                                            {% else %}
                                                                <button class="btn btn-sm btn-success" style="border-color: #398439; color: #398439; background: white; border-radius:13px; width: 90px;" id="apprvBTN"><i class="icon-ok"></i> Approved</button> 
                                                                <button class="btn btn-sm btn-danger" style="width: 90px; border-radius: 13px;" id="declBTN" data-toggle="modal"  data-target="#newReg"><i class="icon-remove"></i> Denied</button>

                                                            {% endif %}
                                                    {% endif %}

                                                 {% endif %}

                                                 

                                            {% endif %}
                                    
                                    {% else %}
                                        
                                        {% if pageData1.1.5 == None %}
                                                 
                                                 <button class="btn btn-sm btn-default" style="width: 90px; border-radius: 13px;" disabled=""><i class="icon-ok"></i> Approved</button> 
                                                 <button class="btn btn-sm btn-default" style="width: 90px; border-radius: 13px;" disabled=""><i class="icon-remove"></i> Denied</button>
                                            
                                        {% else %}
                                              
                                                {% if pageData1.0.8 == None %}
                                                     
                                                     <button class="btn btn-sm btn-success" style="width: 90px; border-radius: 13px;" id="apprvBTN"><i class="icon-ok"></i> Approved</button> 
                                                     <button class="btn btn-sm btn-danger" style="width: 90px; border-radius: 13px;" id="declBTN" data-toggle="modal"  data-target="#newReg"><i class="icon-remove"></i> Denied</button>
                                                 
                                                 {% else %}
                                                    {% if pageData1.1.7 != None %}
                                                            {% if pageData1.0.8 == True %}
                                                                <button class="btn btn-sm" style="border-color: #398439; color: #398439; background: white; width: 90px;" disabled=""><i class="icon-ok"></i> Approved</button>
                                                                
                                                            {% else %}
                                                                 
                                                               <button class="btn btn-sm " style="border-color: #d43f3a; color: #d43f3a; background: white; width: 90px;" disabled=""><i class="icon-remove"></i> Denied</button>

                                                            {% endif %}
                                                    
                                                    {% else %}
                                                            {% if pageData1.0.8 == True %}
                                                                <button class="btn btn-sm btn-success" style="width: 90px; border-radius: 13px;" id="apprvBTN"><i class="icon-ok"></i> Approved</button> 
                                                                <button class="btn btn-sm btn-danger" style="border-color: #d43f3a; color: #d43f3a; background: white; border-radius:13px; width: 90px;" id="declBTN" data-toggle="modal"  data-target="#newReg"><i class="icon-remove"></i> Denied</button>
                                                            {% else %}
                                                                <button class="btn btn-sm btn-success" style="border-color: #398439; color: #398439; background: white; border-radius:13px; width: 90px;" id="apprvBTN"><i class="icon-ok"></i> Approved</button> 
                                                                <button class="btn btn-sm btn-danger" style="width: 90px; border-radius: 13px;" id="declBTN" data-toggle="modal"  data-target="#newReg"><i class="icon-remove"></i> Denied</button>

                                                            {% endif %}
                                                    {% endif %}

                                                   

                                                {% endif %}

                                        {% endif %}
                                    
                                    {% endif %}

                                        
                                    </div>
                                </div> 
                            </div>
                                
                                <div class="form-group" style="padding-bottom: 47px;">
                                <div style="padding-left: 2px; width:100%; ">
                                    <div class=" dataFont2 col-lg-5" style="padding-top: 13px;">
                                       Release Status:
                                    </div>
                                    <div class="dataFont1 col-lg-7">
                                    
                                    {% if pageData1.4.0 == 'vcaf' %}
                                         
                                         {% if pageData1.0.7 == None %}
                                                 
                                                <button class="btn btn-sm btn-default" style="width: 90px; border-radius: 13px;" disabled=""><i class="icon-ok"></i> Release</button>
                                            
                                            {% else %}
                                                {% if pageData1.1.3 == None %}
                                                    <button class="btn btn-sm btn-primary" style="width: 90px; border-radius: 13px;" id="relBTN"><i class="icon-ok"></i> Release</button>
                                                {% else %}
                                                    <button class="btn btn-sm btn-primary" style="width: 90px; border-color: #285e8e; color: #285e8e; background: white;" disabled=""><i class="icon-ok"></i> Released</button>
                                                {% endif %}

                                            {% endif %}
                                    
                                    {% else %}

                                         {% if pageData1.0.8 == None %}
                                                 
                                                <button class="btn btn-sm btn-default" style="width: 90px; border-radius: 13px;" disabled=""><i class="icon-ok"></i> Release</button>
                                            
                                            {% else %}
                                                {% if pageData1.1.7 == None %}
                                                    <button class="btn btn-sm btn-primary" style="width: 90px; border-radius: 13px;" id="relBTN"><i class="icon-ok"></i> Release</button>
                                                {% else %}
                                                    <button class="btn btn-sm btn-primary" style="width: 90px; border-color: #285e8e; color: #285e8e; background: white;" disabled=""><i class="icon-ok"></i> Released</button>
                                                {% endif %}

                                            {% endif %}
                                    
                                    {% endif %}
                                       
                                        
                                    </div>
                                </div> 
                            </div>

                            </div>


                        </div>
                    </div>

                  
                
                <div class="col-lg-12" style="display: inline;">
                    
                       

                        <!--  -->
                        
                        <div class="panel panel-info">
                            <div class="panel-heading">
                                <h3 class="panel-title">Purchase Order Items</h3>
                            </div>
                            <div class="panel-body">
                                <div class="table-responsive">
                                <table class="table table-striped table-bordered table-hover" id="theTable">
                                    <thead >
                                        <tr>
                                            <th class="text-center" style="width:90px;">Item No.</th>
                                            <th>Requested Item Description</th>
                                            <th class="text-right">Quantity</th>
                                            <th class="text-center">Unit</th>
                                            <th class="text-right">Unit Cost</th>
                                            <th class="text-right">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    {% for x in pageData2 %}
                                    
                                    <tr>
                                       <td class="text-center">{{x.1}}</td> 
                                       <td>{{x.2}}</td>
                                       <td class="text-right">{{x.5|floatformat|intcomma}}</td>    
                                       <td class="text-center">{{x.3}}</td>
                                       <td class="text-right">{{x.4|floatformat|intcomma}}</td>
                                       <td class="text-right">{{x.6|floatformat|intcomma}}</td>

                                    </tr>
                                   
                                    {% endfor %}


                                        
                                    </tbody>
                                </table>
                            </div>
                                
                            </div>
                        </div>
                    
                    <!-- -->

                </div>
                <div class="col-lg-12">
                    <div class="panel panel-info">
                    <div class="panel-body">

                    <div style="   
                                     display:inline;
                                     float:right; 
                                     right:0; 
                                     padding-right:20px;">

                       <div class="form-group">
                  <div class="header-right" style="padding-top:0px;">
                                                                
                      <div style="display: inline; font-weight: 400;  font-size: 14px;">
                           Estimated Total Cost: 
                    </div>
                                                                
                        <div class="panel panel-default" style="display: inline; font-size: 18px;  font-weight: 400; padding:10px;">
                             {{pageData1.4.1|floatformat|intcomma}}
                        </div>
                    
                    </div> 

               </div>

                 </div></div>
                        
                    </div>
                </div>
                

                <!-- /. ROW  -->
                
                  

                <div class="panel-body"  style="padding:0px;">
                    

               </div>
<!-- ===================================================   Modal ==================================================================================  -->
           
                       <div class="modal fade" id="decideComp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog ">
                                <div class="modal-content ">
                                   
                                    
                                    <div class="modal-body ">

                                        <div class="media" role="submit" name="notif1" id="notif1" value="GGWP">
                                    
                                            <span class="pull-left" >
                                                <div class="btn btn-success btn-lg btn-circle" role="button" aria-disabled="true" disabled = "disabled">
                                                    <i class="icon-ok"></i></div>
                                    </span>  
                                    <div class="media-body">
                                        <h5 class="media-heading" style="margin-top:10px;">
                                            <strong>Saving information update</strong>
                                        </h5>
                                        <hr>
                                        
                                        <p style="margin-bottom:10px;">• The request apporval is now updated to your selected information.</p>
                                        <p style="margin-bottom:10px;">• You can change it anytime, on sudden changes on decission of the approving officer, as long your office is still on possession of the P.R. document</p> 
                                         
                                    </div>
                                    

                                </div>
                                        
                                    </div>
                                        
                                    <div class="modal-footer">
                                            <button id="desNotif" type="submit" class="btn btn-info" data-dismiss="modal">OK</button>
                                    </div>
                                </div>
                            </div>
                        </div>

<!-- ===================================================   Modal ==================================================================================  --><!-- ===================================================   Modal ==================================================================================  -->
           
                       <div class="modal fade" id="newReg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <form action="" method="POST">{% csrf_token %} 
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h4 class="modal-title" id="H4"> Enter reason of denial</h4>
                                    </div>
                                   
                                    
                                    <div class="modal-body">

                                            <div class="checkbox" >
                                                        <label>
                                                            <div class="checker hover"><span><input checked id="chck1" class="uniform" type="checkbox" value="option1"></span></div>Select a Reason
                                                        </label>
                                             </div>
                                             
                                             <div>
                                                <select id="selReason" class="form-control">
                                                <option>On tight budget</option>
                                                <option>Unreasonable request</option>
                                                <option>Date interval of last the account is too near</option>
                                            </select>

                                             </div>
                                             

                                             <div class="checkbox">
                                                        <label>
                                                            <div class="checker hover"><span><input id="chck2" class="uniform" type="checkbox" value="option2"></span></div>Specify Reason
                                                        </label>
                                             </div>
                                                    
                                                    <div>
                                                        <textarea id="reasonIn" class="form-control" style="overflow: hidden; word-wrap: break-word; resize: horizontal; height: 100px;" disabled></textarea>
                                                    </div>
                                                
                                      
                                    </div>
                                   
                                      
                                          <div class="modal-footer">
                                            <button id="submitDecline" data-dismiss="modal" type="button" role="button" class="btn btn-success">Submit</button>
                                    </div>

                                        
                                       
                                     
                                     
                                    
                                </div>
                                </form>
                            </div>
                        </div>

<!-- ===================================================   Modal ==================================================================================  -->


                </div>    

                </div>

            </div>
            <!-- /. PAGE INNER  -->
        </div>
        <!-- /. PAGE WRAPPER  -->
    </div>
    <!-- /. WRAPPER  -->
    <div id="footer-sec">
        &copy; Mindanao State University - General Santos City
    </div>
    <!-- /. FOOTER  -->
    <!-- SCRIPTS -AT THE BOTOM TO REDUCE THE LOAD TIME-->
    <!-- JQUERY SCRIPTS -->
    <script src="{% static 'procurement/assets/js/jquery-1.10.2.js' %}"></script>
    <!-- BOOTSTRAP SCRIPTS -->
    <script src="{% static 'procurement/assets/js/bootstrap.js' %}"></script>
    <!-- METISMENU SCRIPTS -->
    <script src="{% static 'procurement/assets/js/jquery.metisMenu.js' %}"></script>
    <!-- CUSTOM SCRIPTS -->
    <script src="{% static 'procurement/assets/js/custom.js' %}"></script>
    
   <script type="text/javascript">
            
    $(document).ready(function () {
        $('#pr').attr('class', 'active-menu-approv')
        $('#proTop').attr('class', 'active-menu-top')
        $('#proUL').attr('class','nav nav-second-level collapse in')
    })

    </script>
    
    <script type="text/javascript">

            var decision = '';
            var reasonRef = 'select';
            var reason = '';


    $('#chck1').click(function(e) {
        reasonRef = 'select';
       $('#chck2').removeAttr('checked')
       $('#reasonIn').attr('disabled', '')
       $('#selReason').removeAttr('disabled')
    });



    $('#chck2').click(function(e) {
        reasonRef = 'define';
       $('#chck1').removeAttr('checked')
       $('#selReason').attr('disabled', '')
       $('#reasonIn').removeAttr('disabled')
    });
            
    $('desNotif').click(function (e) {
        $('#decideComp').modal('toggle');
        location.reload();
    })

    

            $('#apprvBTN').click(function (e) {
                

                e.preventDefault();
                    
                    $.ajax({
                        type: 'POST',
                        url:'/approving_officer_representative/decidePR/',
                        data:{
                            
                            'decision': 'approve',
                            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),

                        },

                            success:function() {
                                $('#decideComp').modal('toggle');
                                $('#declBTN').attr('style', 'border-color: #d43f3a; color: #d43f3a; background: white; border-radius:13px; width: 90px;')
                                $('#apprvBTN').attr('class', 'btn btn-success btn-sm')
                                $('#apprvBTN').attr('style', 'border-radius:13px; width: 90px;')
                                



                        }

                    });
            })


            $('#submitDecline').click(function (e) {
                    
                    if (reasonRef === 'select') {
                        reason = $('#selReason').val();
                    }else{
                        reason = $('#reasonIn').val();
                    }
                    
                    $.ajax({
                        type: 'POST',
                        url:'/approving_officer_representative/declinePR/',
                        data:{
                            
                            'reason': reason,
                            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),

                        },

                            success:function() {

                                $('#decideComp').modal('toggle');
                                $('#apprvBTN').attr('style', 'border-color: #398439; color: #398439; background: white; border-radius:13px; width: 90px;')
                                $('#declBTN').attr('class', 'btn btn-sm btn-danger')
                                $('#declBTN').attr('style', 'border-radius:13px; width: 90px;')



                            }
                            

                    });

            });

            $('#recBTN').click(function (e) {
                 e.preventDefault();
                    
                    $.ajax({
                            type: 'POST',
                            url:'/approving_officer_representative/update_location/',
                            data:{
                                
                                'prRef': $('#reqNum').attr('value'),
                                csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),

                        },

                                success:function(response) {
                                    $('#recBTN').attr('class', 'btn btn-sm')
                                    $('#recBTN').attr('disabled', '')
                                    $('#recBTN').attr('style', 'border-color: #449d44; color: #449d44; background: white;')
                                    location.reload()

                                   
                            } 

                    });
            })

            $('#relBTN').click(function (e) {
                 e.preventDefault();
            
                 
                    $.ajax({
                            type: 'POST',
                            url:'/approving_officer_representative/update_location/',
                            data:{
                                
                                'prRef': $('#reqNum').attr('value'),
                                csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),

                        },

                                success:function(response) {
                                    $('#relBTN').attr('class', 'btn btn-sm')
                                    $('#relBTN').attr('disabled', '')
                                    $('#relBTN').attr('style', 'border-color: #285e8e; color: #285e8e; background: white;')
                                    location.reload()

                                   
                            } 

                    });
            });

    </script>

{% endblock %}
